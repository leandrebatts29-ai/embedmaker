<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Web Embedder</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --sidebar: #ffffff;
        }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: var(--bg);
            overflow: hidden;
        }
        #sidebar {
            width: 260px;
            background: var(--sidebar);
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            padding: 15px;
            flex-shrink: 0;
        }
        h3 { font-size: 14px; text-transform: uppercase; color: #64748b; margin-top: 20px; }
        #history-list { list-style: none; padding: 0; overflow-y: auto; flex-grow: 1; }
        .history-item {
            padding: 8px 12px;
            background: #f1f5f9;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            word-break: break-all;
        }
        .history-item:hover { background: #e2e8f0; }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .header {
            padding: 15px;
            background: #fff;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            outline: none;
        }
        button {
            padding: 10px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }
        .btn-alt { background: #64748b; }
        .btn-save { background: #10b981; }

        #embed-viewport {
            flex-grow: 1;
            border: none;
            background: #fff;
        }
        .note-area {
            font-size: 11px;
            color: #475569;
            padding: 8px 15px;
            background: #fefce8;
            border-bottom: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Embedder</h2>
        <h3>History</h3>
        <div id="history-list"></div>
        <button onclick="clearHistory()" style="background:#ef4444; margin-top:10px;">Clear All</button>
    </div>

    <div class="main-content">
        <div class="header">
            <input type="text" id="urlInput" placeholder="Paste link here...">
            <button onclick="loadSite()">Go</button>
            <button class="btn-save" onclick="saveCurrentToHistory()" title="Save current link to history">Save Current</button>
            <button class="btn-alt" onclick="toggleFullscreen()">Fullscreen</button>
        </div>
        
        <div class="note-area">
            <b>Note:</b> If you click a link *inside* the window and it doesn't show in the history, click <b>"Save Current"</b> to manually bookmark it. Also, some sites like Google, YouTube, basically all of the big sites won't work here. And if you're using this for blockn't purposes, and it still shows up as blocked, just reembed, it'll work after a bit, but some sites won't. Thanks for coming.
        </div>

        <iframe 
            id="embed-viewport" 
            src="about:blank" 
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups" 
            referrerpolicy="no-referrer"
            allowfullscreen>
        </iframe>
    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const iframe = document.getElementById('embed-viewport');
        const historyList = document.getElementById('history-list');

        let history = JSON.parse(localStorage.getItem('embedHistory')) || [];
        renderHistory();

        function loadSite(customUrl = null) {
            let url = customUrl || urlInput.value.trim();
            if (!url) return;
            if (!url.startsWith('http')) url = 'https://' + url;

            iframe.src = url;
            urlInput.value = url; // Keep input in sync
            if (!customUrl) saveToHistory(url);
        }

        function saveCurrentToHistory() {
            // Try to get the URL from the iframe. 
            // Note: This only works if the site has the same origin or allows it.
            try {
                const currentUrl = iframe.contentWindow.location.href;
                if (currentUrl && currentUrl !== "about:blank") {
                    saveToHistory(currentUrl);
                } else {
                    saveToHistory(urlInput.value);
                }
            } catch (e) {
                // If blocked by security, we save whatever is in the input box
                saveToHistory(urlInput.value);
            }
        }

        function saveToHistory(url) {
            if (!url || url === "about:blank") return;
            // Remove existing instance if it's already there to move it to top
            history = history.filter(item => item !== url);
            history.unshift(url);
            if (history.length > 20) history.pop();
            localStorage.setItem('embedHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            historyList.innerHTML = '';
            history.forEach(url => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerText = url;
                div.onclick = () => loadSite(url);
                historyList.appendChild(div);
            });
        }

        function toggleFullscreen() {
            if (iframe.requestFullscreen) iframe.requestFullscreen();
            else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
        }

        function clearHistory() {
            history = [];
            localStorage.removeItem('embedHistory');
            renderHistory();
        }

        urlInput.addEventListener("keypress", (e) => { if (e.key === "Enter") loadSite(); });
    </script>
</body>
</html>
